<!DOCTYPE html>
<html>
<head>
  <title>Talksy Mini Chat</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #ffecd2, #fcb69f);
      padding: 20px;
      margin: 0;
    }

    h1 { text-align: center; }

    input {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: none;
      width: 250px;
    }

    button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      margin: 3px;
    }

    .auth-box {
      text-align: center;
      margin-bottom: 20px;
    }

    .chat-box {
      display: none;
    }

    .post {
      background: white;
      padding: 12px;
      border-radius: 12px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .deleteBtn {
      background: #ff4b5c;
      color: white;
    }

    .logoutBtn {
      background: #333;
      color: white;
    }
  </style>
</head>
<body>

<h1>Talksy Mini Chat</h1>

<div class="auth-box" id="authBox">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="signUp()">Sign Up</button>
  <button onclick="login()">Login</button>
</div>

<div class="chat-box" id="chatBox">
  <p id="welcome"></p>
  <button class="logoutBtn" onclick="logout()">Logout</button>
  <br><br>

  <input type="text" id="messageInput" placeholder="Type message">
  <button onclick="sendMessage()">Send</button>

  <div id="posts"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCK3dYhgPl-CWJ9JuiI2rVuuv00Q7Do9f4",
  authDomain: "talksy-mini.firebaseapp.com",
  projectId: "talksy-mini",
  storageBucket: "talksy-mini.appspot.com",
  messagingSenderId: "1044754891732",
  appId: "1:1044754891732:web:9b933f3d18a17e246a8c41"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const authBox = document.getElementById("authBox");
const chatBox = document.getElementById("chatBox");
const postsDiv = document.getElementById("posts");
const welcome = document.getElementById("welcome");


// SIGN UP
function signUp() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  auth.createUserWithEmailAndPassword(email, password)
    .catch(error => alert(error.message));
}

// LOGIN
function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email, password)
    .catch(error => alert(error.message));
}

// LOGOUT
function logout() {
  auth.signOut();
}

// AUTH STATE LISTENER
auth.onAuthStateChanged(user => {
  if (user) {
    authBox.style.display = "none";
    chatBox.style.display = "block";
    welcome.innerText = "Logged in as: " + user.email;
    loadMessages(user);
  } else {
    authBox.style.display = "block";
    chatBox.style.display = "none";
    postsDiv.innerHTML = "";
  }
});


// SEND MESSAGE
function sendMessage() {
  const user = auth.currentUser;
  const message = document.getElementById("messageInput").value;

  if (!message) return;

  db.collection("posts").add({
    uid: user.uid,
    email: user.email,
    message: message,
    timestamp: Date.now()
  });

  document.getElementById("messageInput").value = "";
}


// LOAD MESSAGES
function loadMessages(user) {
  db.collection("posts")
    .orderBy("timestamp")
    .onSnapshot(snapshot => {
      postsDiv.innerHTML = "";

      snapshot.forEach(doc => {
        const post = doc.data();

        const postDiv = document.createElement("div");
        postDiv.className = "post";

        const displayName = post.email.split('@')[0]; // Take only the part before @
postDiv.innerHTML = `
  <strong>${displayName}</strong><br>
  ${post.message}
`;

        // Only show delete if owner
        if (post.uid === user.uid) {
          const deleteBtn = document.createElement("button");
          deleteBtn.innerText = "Delete";
          deleteBtn.className = "deleteBtn";
          deleteBtn.onclick = () => {
            db.collection("posts").doc(doc.id).delete();
          };
          postDiv.appendChild(deleteBtn);
        }

        postsDiv.appendChild(postDiv);
      });
    });
}
</script>

</body>
</html>
