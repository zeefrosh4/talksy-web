<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talksy Web</title>
<style>
  body { font-family: Arial, sans-serif; background: #e0f7ff; margin: 0; padding: 0; }
  #login, #chat { max-width: 500px; margin: 20px auto; padding: 20px; background: #f0f8ff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  input { width: calc(100% - 20px); margin: 5px 0; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
  button { padding: 10px 20px; border: none; border-radius: 5px; background: #00bfff; color: white; cursor: pointer; margin: 5px 0; }
  button:hover { background: #1e90ff; }
  #messages { height: 400px; overflow-y: auto; padding: 10px; background: linear-gradient(to right, #87ceeb, #00bfff); border-radius: 10px; }
  .msg { padding: 5px 10px; margin: 5px 0; border-radius: 5px; display: inline-block; max-width: 80%; word-wrap: break-word; }
  .me { background: #add8e6; align-self: flex-end; }
  .other { background: #87ceeb; align-self: flex-start; }
</style>
</head>
<body>

<div id="login">
  <h2>Talksy Web Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <button id="signupBtn">Sign Up</button>
</div>

<div id="chat" style="display:none">
  <h2>Group Chat</h2>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button id="sendBtn">Send</button>
  <button id="logoutBtn">Logout</button>
</div>

<script type="module">
// Firebase SDK imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyChDnxFngUE5PNQny6J1l-1Pu74gWn7LTY",
  authDomain: "talksy-live.firebaseapp.com",
  projectId: "talksy-live",
  storageBucket: "talksy-live.firebasestorage.app",
  messagingSenderId: "468137831789",
  appId: "1:468137831789:web:9872c8fb7a44f25a4cfe64"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUser = null;

// Show chat UI
function showChat() {
  document.getElementById('login').style.display = 'none';
  document.getElementById('chat').style.display = 'block';
  loadMessages();
}

// Login
document.getElementById('loginBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  const pass = document.getElementById('password').value;
  try {
    const userCred = await signInWithEmailAndPassword(auth, email, pass);
    currentUser = userCred.user;
    showChat();
  } catch(err) { alert(err.message); }
});

// Sign Up
document.getElementById('signupBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  const pass = document.getElementById('password').value;
  try {
    const userCred = await createUserWithEmailAndPassword(auth, email, pass);
    currentUser = userCred.user;
    showChat();
  } catch(err) { alert(err.message); }
});

// Logout
document.getElementById('logoutBtn').addEventListener('click', async () => {
  await signOut(auth);
  currentUser = null;
  document.getElementById('chat').style.display = 'none';
  document.getElementById('login').style.display = 'block';
});

// Send message
document.getElementById('sendBtn').addEventListener('click', async () => {
  const msg = document.getElementById('messageInput').value;
  if(!msg) return;
  await addDoc(collection(db, "messages"), {
    text: msg,
    createdAt: serverTimestamp(),
    user: currentUser.email,
    chatId: "group"
  });
  document.getElementById('messageInput').value = '';
});

// Load messages in real-time
function loadMessages() {
  const q = query(collection(db, "messages"), orderBy("createdAt"));
  onSnapshot(q, (snapshot) => {
    const msgDiv = document.getElementById('messages');
    msgDiv.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement('div');
      div.classList.add('msg');
      div.classList.add(currentUser.email === data.user ? 'me' : 'other');
      div.textContent = `${data.user}: ${data.text}`;
      msgDiv.appendChild(div);
      msgDiv.scrollTop = msgDiv.scrollHeight;
    });
  });
}
</script>

</body>
</html>
